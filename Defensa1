#del paquete Survival
library(survival)

#cargando la data
library(readr)
urlfile<-"https://raw.githubusercontent.com/ElmerZelaya/MM-700-Seminario-de-Investigacion/main/DATA.csv"
data<-read.csv(urlfile)

#mostrando la data
head(data)


#recodificando las variables categoricas con la funcion factor():

data$actividad<-factor(data$actividad,levels=c("1","2","3","4","5"),
                       labels=c("actividades prof","alojamiento","comercio","comida","transporte"))
data$financiamiento<-factor(data$financiamiento,levels=c("1","2","3","4"),
                            labels=c("Banco","Cooperativa","Inst. no bancaria","familiar"))
data$tamano<-factor(data$tamano,levels=c("1","2"),
                    labels=c("micro","pequena"))
head(data)


# ~ ~ ~ ~ Analisis descriptivo de los datos ~ ~ ~ ~ #

#Comenzaremos mostrando el numero de empresas por grupo en sus factores
######   Actividades Economicas    #####

table(data$actividad) # frecuencias absoluta
prop.table(table(data$actividad)) # Frecuencia relativas
barplot(prop.table(table(data$actividad)),col="steelblue",ylim = c(0, 0.40),space = 0.5,
        xlab="Actividades economicas", ylab="Frecuencia relativa", 
        main="Actividades Economicas") #grafico de barra

######   Tipo de financiamiento   #####
table(data$financiamiento)
prop.table(table(data$financiamiento))
barplot(prop.table(table(data$financiamiento)), ylim = c(0, 0.35),col="steelblue",space =
          0.5,xlab="Tipo de Financiamiento", ylab="Frecuencia relativa", 
        main="Tipo de Financiamiento")

######   tamano de la empresa   ######
table(data$tamano)
prop.table(table(data$tamano))
barplot(prop.table(table(data$tamano)),col="steelblue",space = 0.6,ylim = c(0, 0.80),xlab
        ="Tamaño de la Empresa", ylab="Frecuencia relativa", 
        main="Tamano de la empresa")

# analisis descriptivo de las censuras y observaciones (0 indica censura, 1 indica observacion).

# en toda la muestra:
with(data,table(estado))

# por factores:

######  Actividades economicas ######

# Frecuenica absoluta
table(data$actividad,data$estado) 
#frecuencia relativa dentro del factor
prop.table(table(data$financiamiento,data$estado)) 
#Frecuencia relativa dentro del grup
table(data$actividad,data$estado)/as.numeric(table(data$actividad)) 

######   Tipo de financiamientociamiento   #######

table(data$financiamiento,data$estado)  
prop.table(table(data$financiamiento,data$estado))  
table(data$financiamiento,data$estado)/as.numeric(table(data$financiamiento)) 

#######   tamano de la empresa   #######
with(data,table(data$tamano,data$estado))
prop.table(table(data$tamano,data$estado))
table(data$tamano,data$estado)/as.numeric(table(data$tamano)) 

#tiempos de supervivencia.

#Mostrando todos los tiempos(incluyendo cuando ocurre el evento y cuando no)
#un signo "+" acompañando el numero indica cuando hubo censura
Surv ( data$tiempo , data$estado )  

#tiempos donde se presenta el evento
data$tiempo [ data$estado == 1 ]

#tiempos donde se presenta el evento (ordenados)
sort(data$tiempo [ data$estado == 1 ])

#frecuencia de estos tiempos 
table( data$tiempo [ data$estado == 1 ] )
# Frecuencia relativas
prop.table(table(data$tiempo[data$estado==1])) 
#grafic
barplot(prop.table(table(data$tiempo[data$estado==1])),ylim = c(0, 0.25),xlab = ,50,col
        ="steelblue",border="lightblue")

#distribucion de los tiempos de supervivencia.

#######   actividades economicas   ######
table( data$actividad[data$estado==1], data$tiempo [ data$estado == 1 ])

######    tipo de financiamiento   ######
table( data$financiamiento[data$estado==1], data$tiempo [ data$estado == 1 ])

######    tamano de la empresa   #######
table( data$tamano[data$estado==1], data$tiempo [ data$estado == 1 ])
